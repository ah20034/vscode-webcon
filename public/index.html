<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WebCon Demo</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 2rem; line-height: 1.6; }
    a { color: #0b5fdf; }
    header { display: flex; align-items: baseline; gap: .75rem; }
    header h1 { margin: 0; }
    ul { margin-top: 1rem; }
    code { background: #f5f5f5; padding: 0.2rem 0.4rem; border-radius: 4px; }
  </style>
</head>
<body>
  <header>
    <h1>WebCon サンプル</h1>
    <small>Express + A-Frame + AR.js</small>
  </header>
  

  <hr />

  <section>
    <h2>カメラをこのページで起動して表示</h2>
    <p>HTTPS（または localhost）でのみ動作します。初回はカメラの使用許可が求められます。</p>
    <div style="display:flex; gap:.5rem; align-items:center; flex-wrap:wrap;">
      <button id="startCam">カメラ起動</button>
      <button id="stopCam" disabled>停止</button>
      <span id="camStatus" style="opacity:.8;">待機中</span>
    </div>
    <div style="margin-top: .75rem;">
      <video id="preview" playsinline autoplay muted style="width:min(720px,95vw); background:#000; border-radius:.5rem;"></video>
    </div>
  </section>

  <script>
    const startBtn = document.getElementById('startCam');
    const stopBtn = document.getElementById('stopCam');
    const statusEl = document.getElementById('camStatus');
    const videoEl = document.getElementById('preview');
    let stream = null;

    function setStatus(s){ statusEl.textContent = s; }

    startBtn.addEventListener('click', async () => {
      try {
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
          alert('このブラウザはカメラ API に対応していません。');
          return;
        }
        setStatus('権限確認中…');
        startBtn.disabled = true;
        stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: { ideal: 'environment' } },
          audio: false
        });
        videoEl.srcObject = stream;
        setStatus('映像取得中');
        stopBtn.disabled = false;
      } catch (e) {
        console.error(e);
        setStatus('起動失敗: ' + (e && e.name || 'Unknown'));
        alert('カメラが起動できません。権限設定（ブロック→許可に変更）や、他アプリが使用中でないか確認してください。');
        startBtn.disabled = false;
      }
    });

    stopBtn.addEventListener('click', () => {
      if (stream) {
        stream.getTracks().forEach(t => t.stop());
        stream = null;
        videoEl.srcObject = null;
        setStatus('停止しました');
        stopBtn.disabled = true;
        startBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
